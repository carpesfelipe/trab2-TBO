Função Intercalar_P_Vias(ListaDeArquivosIniciais, P)
  // ListaDeArquivosIniciais: Os M blocos ordenados iniciais, distribuídos entre 2P dispositivos
  // P: O número de arquivos que serão intercalados simultaneamente em cada passo

  Conjunto_A = Dispositivos 0 a P-1
  Conjunto_B = Dispositivos P a 2P-1
  
  FUNCAO calcular_tam_grupos
    P elevado a qtd ideracoes do while vezes M

  Fontes = Conjunto_B
  Destinos = Conjunto_A
  ContadorRunsGeradosNestaPassagem = 0

 While (ContadorRunsGeradosNestaPassagem != 1): //significa que nao temos apenas 1 arquivo ordenado (significa q n acabou)
    ContadorRunsGeradosNestaPassagem = 0
    Limpar_Arquivos(Destinos) /para garantir que os arquivos de destino estejam vazios no início da passagem

    calcular tam_grupos
    for(i=0; i<tam_grupos; i++) Para cada grupo no arquivo
        abrir arquivos de Fonte
        abrir arquivos de Destino (tem q fazer um tipo de contador pra saber qual é o da vez, PENSAR)

        fila = inicializa com as primeiras posicoes dos arquivos fonte (fila do tipo linha?)

        while(fila nao esta vazia)
            busca menor
            remove menor da fila e coloca a proxima linha do arquivo - se assegurar q a posicao da linha é menor q m (como saber qual o arquivo, PENSAR) vale apagar do arquivo de origem?
            escreve menor no arquivo destino

        Se stream_origem não estiver vazio:
          Ler proxima linha do stream_origem
          Inserir (nova_linha, ID_stream_origem) na FilaDePrioridade
        Senão:
          // Stream de origem vazio, não há mais linhas para adicionar daquele stream
          // A fila de prioridade continua processando os outros streams

      Fechar todos os streams de leitura e escrita para este grupo
      ContadorRunsGeradosNestaPassagem = ContadorRunsGeradosNestaPassagem + 1
      
    // Preparar para a próxima passagem: alternar Fontes e Destinos
    Trocar(Fontes, Destinos)

    // Se apenas um run foi gerado nesta passagem, significa que a ordenação está completa
    Se ContadorRunsGeradosNestaPassagem == 1:
      Quebrar_Loop

  // O arquivo final ordenado estará nos dispositivos que são 'Fontes' após o loop final
  Retornar Arquivo_Final_Ordenado